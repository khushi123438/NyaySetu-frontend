<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="style.css" />
  <title>NyayaSetu</title>
  <style>
    /* Hide body until session check completes to prevent flash */
    body { visibility: hidden; }
    #chatContainer { display: none; }
  </style>
</head>
<body>

<!-- Navbar -->
<header class="navbar">
  <div class="container nav-content">
    <h1 class="logo">‚öñ NyayaSetu</h1>
    <nav>
      <a href="#" class="login-btn">Home</a>
      <a href="advoacte.html" class="login-btn">Find Advocate</a>
      <a href="contact.html" class="login-btn">Contact Us</a>
      <a href="javascript:void(0)" class="login-btn" id="chatBtn">üí¨ Chatbot</a>
      <a href="news.html" class="login-btn">LegalNews</a>
      <a href="login.html" class="login-btn" id="loginLink">Login/Signup</a>
      <a href="myaccount.html" class="login-btn" id="myAccountLink" style="display:none;">My Account</a>
      <a href="javascript:void(0)" class="login-btn" id="logoutLink" style="display:none;">Logout</a>
    </nav>
  </div>
</header>

<!-- Chatbot -->
<div id="chatContainer">
  <div class="chat-header">
    <span>ü§ñ NyayaSetu Chatbot</span>
    <button class="close-btn" id="closeChat">‚úñ</button>
  </div>
  <iframe src="/chatbot.html"></iframe>
</div>

<!-- Hero Section -->
<section class="hero">
  <h2>Find trusted Advocate and Legal Help</h2>
  <p>Connect with lawyers in your city, get documents and ask our legal chatbot</p>
  <div class="search-bar">
    <input type="text" placeholder="Enter your city and Case type">
    <button onclick="searchAdvocate()">Search</button>
  </div>
</section>

<!-- Advocate Section -->
<section id="advocates" class="section">
  <h3>üë®‚Äç‚öñ Find an Advocate</h3>
  <p>Search advocates by specialization and region</p>
  <div class="grid">
    <div class="card">
      <h4>Criminal law</h4>
      <p>Experienced lawyers in criminal defense and legal rights</p>
    </div>
    <div class="card">
      <h4>Family law</h4>
      <p>Divorce, custody, marriage disputes and more</p>
    </div>
    <div class="card">
      <h4>Corporate law</h4>
      <p>Business contracts, disputes, compliance support</p>
    </div>
  </div>
</section>

<!-- Advocate Profiles (only for logged-in users) -->
<section class="advocateprofiles" id="advocateprofiles" style="display:none;">
  <h3>üë®‚Äç‚öñ Advocate Profiles</h3>
  <p>Browse profiles of top advocates in your area</p>
  <div class="slider-container">
    <button class="scroll-btn left" onclick="scrollSlider('left')">‚¨Ö</button>
    <div class="slider" id="slider"></div>
    <button class="scroll-btn right" onclick="scrollSlider('right')">‚û°</button>
  </div>
</section>

<!-- Footer -->
<footer>
  <section class="footer" id="footer">
    <div class="container">
      <div class="footer-content">
        <h3>‚öñ NyayaSetu</h3>
        <p>Connect with trusted advocates and get legal help</p>
        <p>&copy; 2025 Law. All rights reserved.</p>
      </div>
    </div>
  </section>
</footer>

<script>
const BACKEND = "https://nyaysetu-backend-1-w0hj.onrender.com";

// Navbar elements
const loginLink = document.getElementById("loginLink");
const myAccountLink = document.getElementById("myAccountLink");
const logoutLink = document.getElementById("logoutLink");
const advocateProfiles = document.getElementById("advocateprofiles");

// Chatbot elements
const chatContainer = document.getElementById("chatContainer");
const chatBtn = document.getElementById("chatBtn");
const closeChat = document.getElementById("closeChat");

// Toggle chatbot
chatBtn.addEventListener("click", () => {
  chatContainer.style.display = "block";
});
closeChat.addEventListener("click", () => {
  chatContainer.style.display = "none";
});

// Update navbar based on login status
function updateNavbar(loggedIn) {
  if (loggedIn) {
    loginLink.style.display = "none";
    myAccountLink.style.display = "inline-block";
    logoutLink.style.display = "inline-block";
    advocateProfiles.style.display = "block";
  } else {
    loginLink.style.display = "inline-block";
    myAccountLink.style.display = "none";
    logoutLink.style.display = "none";
    advocateProfiles.style.display = "none";
  }
  document.body.style.visibility = "visible"; // show body after session check
}

// Check session on page load
window.addEventListener("load", async () => {
  try {
    const res = await fetch(`${BACKEND}/session`, { credentials: "include" });
    const data = await res.json();
    updateNavbar(data.loggedIn);
    if (data.loggedIn) loadAdvocates();
  } catch (err) {
    console.error("Session check failed:", err);
    document.body.style.visibility = "visible"; // show body even if error
  }
});

// Logout
logoutLink.addEventListener("click", async () => {
  try {
    await fetch(`${BACKEND}/logout`, { credentials: "include" });
    updateNavbar(false);
    window.location.href = "/login.html";
  } catch(err){
    console.error("Logout failed:", err);
  }
});

// Load advocates dynamically
async function loadAdvocates() {
  try {
    const res = await fetch(`${BACKEND}/advocates`);
    const advocates = await res.json();
    const slider = document.getElementById("slider");
    slider.innerHTML = "";
    advocates.forEach(adv => {
      const card = document.createElement("div");
      card.classList.add("card");
      const imageSrc = adv.image && adv.image.trim() !== "" ? adv.image : "advocate.webp";
      card.innerHTML = `
        <img src="${imageSrc}" alt="Advocate Image" onerror="this.src='advocate.webp'" />
        <h4>${adv.fullname}</h4>
        <p>${adv.specialization || "General Law"}</p>
        <p>üìç ${adv.city}, ${adv.state}</p>
        <button onclick="contactAdvocate('${adv.email}')">Contact</button>
      `;
      slider.appendChild(card);
    });
  } catch(err){
    console.error("Error loading advocates:", err);
  }
}

// Contact advocate
function contactAdvocate(email){
  alert("Contact Advocate at: " + email);
}

// Placeholder search
function searchAdvocate() {
  alert("Search functionality not implemented yet.");
}

// Slider scroll
function scrollSlider(direction){
  const slider = document.getElementById("slider");
  const scrollAmount = 300;
  if(direction === "left") slider.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
  if(direction === "right") slider.scrollBy({ left: scrollAmount, behavior: 'smooth' });
}
</script>
</body>
</html>
