<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>NyaySetu - Login / Signup</title>

<style>
/*==============================
  THEME VARIABLES
==============================*/
:root {
    --bg-gradient: linear-gradient(90deg, #4f46e5, #75f2f2);
    --card-bg: #ffffff;

    --primary: #4f46e5;
    --primary-dark: #3730a3;

    --text-main: #111827;
    --text-secondary: #6b7280;

    --input-border: #93c5fd;
    --input-bg: #ffffff;

    --advocate-bg: #e0f7fa;

    --radius-card: 3rem;
    --radius-input: 0.75rem;
    --radius-pill: 999rem;
}

/*==============================
  BASE
==============================*/
body {
    margin: 0;
    background: var(--bg-gradient);
    font-family: 'Segoe UI', sans-serif;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 1rem;
}

/*==============================
  CARD
==============================*/
.card {
    width: 100%;
    max-width: 500px;
    background: var(--card-bg);
    border-radius: var(--radius-card);
    padding: 2.5rem 2.8rem;
    box-shadow: 0 15px 35px rgba(0,0,0,0.15);
}

/*==============================
  HEADER
==============================*/
.header {
    text-align: center;
    margin-bottom: 1.5rem;
}
.header .icon {
    font-size: 3rem;
}
.header .title {
    font-size: 2.3rem;
    font-weight: 800;
}

/*==============================
  ROLE SELECT
==============================*/
.role-tabs {
    display: flex;
    background: #f3f4f6;
    padding: 6px;
    border-radius: var(--radius-pill);
    margin-bottom: 2rem;
}
.role-btn {
    flex: 1;
    padding: 12px 20px;
    font-size: 1rem;
    font-weight: 600;
    background: transparent;
    border: none;
    border-radius: var(--radius-pill);
    color: var(--text-secondary);
    cursor: pointer;
}
.role-btn.active {
    background: #eef2ff;
    color: var(--primary);
    border-bottom: 3px solid var(--primary);
}

/*==============================
  FORM
==============================*/
.form-title {
    text-align: center;
    font-size: 1.8rem;
    margin-bottom: 1.5rem;
    font-weight: 700;
}

form {
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
}

.input-field {
    width: 92%;
    padding: 14px 16px;
    border-radius: var(--radius-input);
    border: 1px solid var(--input-border);
    background: var(--input-bg);
    font-size: 1rem;
}
.input-field:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(79,70,229,0.35);
}

/*==============================
  SECTIONS
==============================*/
#signup-fields,
#advocate-fields {
    display: none;
    flex-direction: column;
    gap: 1.1rem;
}

.advocate-box {
    background: var(--advocate-bg);
    padding: 1.5rem;
    border-radius: 1rem;
    border: 1px solid var(--input-border);
}
.advocate-title {
    color: var(--primary);
    font-weight: 700;
    margin-bottom: 1rem;
}

/*==============================
  FILE INPUT
==============================*/
.file-input::file-selector-button {
    padding: 8px 16px;
    border-radius: var(--radius-pill);
    background: var(--primary);
    color: white;
    border: none;
    cursor: pointer;
}
.file-input::file-selector-button:hover {
    background: var(--primary-dark);
}

/*==============================
  BUTTON
==============================*/
.submit-btn {
    padding: 15px;
    font-size: 1.2rem;
    font-weight: 700;
    background: var(--primary);
    border: none;
    border-radius: 1.8rem;
    color: white;
    cursor: pointer;
}
.submit-btn:hover {
    background: var(--primary-dark);
}

/*==============================
  TOGGLE
==============================*/
.toggle {
    margin-top: 1.5rem;
    text-align: center;
}
.toggle-btn {
    border: none;
    background: none;
    color: var(--primary);
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
}
.toggle-btn:hover {
    text-decoration: underline;
}

.upload-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.camera-icon {
    font-size: 1.5rem;
    cursor: pointer;
    color: var(--primary);
    transition: 0.2s;
}

.camera-icon:hover {
    transform: scale(1.15);
}

</style>
</head>

<body>

<div class="card">

    <div class="header">
        <div class="icon">âš–</div>
        <div class="title">NyaySetu</div>
    </div>

    <div class="role-tabs">
        <button class="role-btn active" id="btn-user">User</button>
        <button class="role-btn" id="btn-adv">Advocate</button>
    </div>

    <h2 class="form-title" id="form-title">User Login</h2>

    <form id="mainForm">

        <!-- USER SIGNUP FIELDS -->
        <div id="signup-fields">
            
            <input type="text" class="input-field" placeholder="Full Name">
            <input type="tel" class="input-field" placeholder="Mobile Number">
            <input type="text" class="input-field" placeholder="City">
            <input type="text" class="input-field" placeholder="State">
            <input type="text" class="input-field" placeholder="Pincode">
        </div>

        <!-- ADVOCATE EXTRA FIELDS -->
        <div id="advocate-fields" class="advocate-box">
            <p class="advocate-title">Advocate Verification Details</p>

            <input type="text" class="input-field" placeholder="Bar ID (e.g. UP/1234/2021)">
            <input type="number" class="input-field" placeholder="Experience (Years)">

            <fieldset style="padding: 12px; border-radius: 10px;">
                <legend><b>Specialization</b></legend>
                <label><input type="checkbox"> All</label><br>
                <label><input type="checkbox"> Civil</label><br>
                <label><input type="checkbox"> Constitutional</label><br>
                <label><input type="checkbox"> Criminal</label><br>
                <label><input type="checkbox"> Family</label><br>
                <label><input type="checkbox"> Administrative</label><br>
                <label><input type="checkbox"> Commercial</label><br>
                <label><input type="checkbox"> Labour</label><br>
                <label><input type="checkbox"> Taxation</label><br>
                <label><input type="checkbox"> PIL</label><br>
               
            </fieldset>
        </div>

        <!-- COMMON FIELDS -->
        <input type="email" class="input-field" placeholder="Email" required>
        <input type="password" class="input-field" placeholder="Password" required>

        <button type="submit" class="submit-btn" id="submit-btn">Login</button>
    </form>

    <div class="toggle">
        <span id="toggle-text">Don't have an account?</span>
        <button class="toggle-btn" id="toggle-btn">Signup</button>
    </div>
</div>

<script>
let isLogin = true; // true = login, false = signup

const userBtn = document.getElementById("btn-user");
const advBtn = document.getElementById("btn-adv");
const formTitle = document.getElementById("form-title");
const toggleBtn = document.getElementById("toggle-btn");
const toggleText = document.getElementById("toggle-text");
const signupFields = document.getElementById("signup-fields");
const advocateFields = document.getElementById("advocate-fields");
const submitBtn = document.getElementById("submit-btn");
const mainForm = document.getElementById("mainForm");

let signupRole = "User"; // role selected during signup

// ===== Toast function =====
function showToast(message, color = "green", duration = 1500) {
    const toast = document.createElement("div");
    toast.innerText = message;
    toast.style.position = "fixed";
    toast.style.bottom = "20px";
    toast.style.right = "20px";
    toast.style.background = color;
    toast.style.color = "white";
    toast.style.padding = "12px 20px";
    toast.style.borderRadius = "8px";
    toast.style.boxShadow = "0 4px 12px rgba(0,0,0,0.2)";
    toast.style.zIndex = "9999";
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), duration);
}

// ===== UI update =====
function updateUI() {
    formTitle.innerText = `${signupRole} ${isLogin ? "Login" : "Signup"}`;
    submitBtn.innerText = isLogin ? "Login" : "Create Account";
    signupFields.style.display = isLogin ? "none" : "flex";
    advocateFields.style.display = (!isLogin && signupRole === "Advocate") ? "flex" : "none";
    toggleText.innerText = isLogin ? "Don't have an account?" : "Already have an account?";
    toggleBtn.innerText = isLogin ? "Signup" : "Login";

    userBtn.classList.toggle("active", signupRole === "User");
    advBtn.classList.toggle("active", signupRole === "Advocate");
}

// ===== Role selection (signup only) =====
userBtn.onclick = () => { signupRole = "User"; updateUI(); };
advBtn.onclick = () => { signupRole = "Advocate"; updateUI(); };

// Toggle login/signup
toggleBtn.onclick = () => { 
    isLogin = !isLogin; 
    updateUI(); 
};

updateUI();

// ===== Form submit =====
mainForm.addEventListener("submit", async (e) => {
    e.preventDefault();

    const email = mainForm.querySelector('input[type="email"]').value.trim();
    const password = mainForm.querySelector('input[type="password"]').value.trim();

    if (!email || !password) {
        showToast("Email and Password are required", "red");
        return;
    }

   if (isLogin) {
    // ===== LOGIN =====
    try {
        const res = await fetch("https://nyaysetu-backend.vercel.app/auth/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ 
        email, 
        password, 
        role: signupRole   // <-- FIXED (remove capitalizing)
    })
});

        const data = await res.json();
        console.log("LOGIN RESPONSE:", data);   // <-- CHECK THIS IN CONSOLE

        if (!res.ok || !data.success) {
            showToast(data.message || "Invalid credentials", "red");
            return;
        }
localStorage.setItem("userToken", data.token);
localStorage.setItem("role", data.role || signupRole);
localStorage.setItem("name", data.user?.name || "");
localStorage.setItem("email", data.user?.email || "");
localStorage.setItem("mobile", data.user?.mobile || "");



        showToast("Login successful!", "green");

        setTimeout(() => {
            if (data.role?.toLowerCase() === "user")
                window.location.href = "user.html";
            else if (data.role?.toLowerCase() === "advocate")
                window.location.href = "client.html";
        }, 1000);

    } catch (err) {
        console.error(err);
        showToast("Server error, try again later", "red");
    }


     // ===== SIGNUP =====
} else {
    try {
        const name = signupFields.querySelector('input[placeholder="Full Name"]').value.trim();
        const mobile = signupFields.querySelector('input[placeholder="Mobile Number"]').value.trim() || "";
        const city = signupFields.querySelector('input[placeholder="City"]').value.trim() || "";
        const state = signupFields.querySelector('input[placeholder="State"]').value.trim() || "";
        const pincode = signupFields.querySelector('input[placeholder="Pincode"]').value.trim() || "";

        let barId = "", experience = "", specialization = [];
        if (signupRole === "Advocate") {
            barId = advocateFields.querySelector('input[placeholder^="Bar ID"]').value.trim() || "";
            experience = advocateFields.querySelector('input[placeholder^="Experience"]').value.trim() || "";
            const checkboxes = advocateFields.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(cb => { 
                if(cb.checked) specialization.push(cb.nextSibling.textContent.trim()); 
            });
        }

        if (!name || !email || !password) {
            showToast("Name, Email and Password are required", "red");
            return;
        }

        // ðŸ”µ USER â†’ /auth/signup
        // ðŸ”µ ADVOCATE â†’ /advocate/signup
        let url = "https://nyaysetu-backend.vercel.app/auth/signup";
        if (signupRole === "Advocate") url = "https://nyaysetu-backend.vercel.app/authAdvocate/signup";

        const res = await fetch(url, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ 
        name,
        email,
        password,
        mobile,
        city,
        state,
        pincode,
        role: signupRole,   // <-- Add this line
        barId,
        experience,
        specialization
    })
});


        const data = await res.json();

        if (!res.ok || !data.success) {
            showToast(data.message || "Signup failed", "red");
            return;
        }

        // Save ALL signup details
localStorage.setItem("name", name);
localStorage.setItem("email", email);
localStorage.setItem("mobile", mobile);
localStorage.setItem("city", city);
localStorage.setItem("state", state);
localStorage.setItem("pincode", pincode);
localStorage.setItem("role", signupRole);

if (signupRole === "Advocate") {
    localStorage.setItem("barId", barId);
    localStorage.setItem("experience", experience);
    localStorage.setItem("specialization", JSON.stringify(specialization));
}


        showToast("Signup successful! Redirecting to login...", "green");
        setTimeout(() => { isLogin = true; updateUI(); }, 1500);

    } catch (err) {
        console.error(err);
        showToast("Server error, try again later", "red");
    }
}

});
</script>
</body>
</html>     