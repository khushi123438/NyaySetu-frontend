<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NyayaSetu - Find Advocates</title>
<style>
  /* --- Global Styles --- */
  body {
    font-family: 'Segoe UI', sans-serif;
    margin: 0;
    background: linear-gradient(90deg, #4f46e5, #75f2f2);
    color: #222;
  }
  h1 {
    text-align: center;
    color: white;
    font-size: 35px;
    margin: 30px 0 10px 0;
  }
  p.intro {
    text-align: center;
    font-size: 24px;
    margin-bottom: 30px;
    color: white;
  }

  /* --- Search Box --- */
  .search-box {
    text-align: center;
    margin-bottom: 40px;
  }
  .search-box input {
    padding: 12px 15px;
    border-radius: 12px;
    border: 1px solid #ddd;
    width: 200px;
    font-size: 15px;
    outline: none;
    transition: 0.3s;
  }
  .search-box input:focus {
    border-color: #4f46e5;
    box-shadow: 0 0 8px rgba(79,70,229,0.2);
  }
  .search-box button {
    background: linear-gradient(90deg,#4f46e5,#75f2f2);
    color: #fff;
    padding: 12px 18px;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    margin-left: 8px;
    font-weight: 600;
    transition: 0.3s;
  }
  .search-box button:hover {
    background: linear-gradient(90deg,#3730a3,#4f46e5);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  }

  /* --- Case Type Cards --- */
  #caseList {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 20px;
    margin-bottom: 50px;
  }
  .case-type {
    background: #fff;
    border-radius: 16px;
    padding: 20px 25px;
    width: 220px;
    cursor: pointer;
    box-shadow: 0 6px 18px rgba(0,0,0,0.08);
    text-align: center;
    transition: transform 0.3s, box-shadow 0.3s;
  }
  .case-type:hover {
    transform: translateY(-5px) scale(1.03);
    box-shadow: 0 12px 24px rgba(0,0,0,0.15);
    background: #f0f4ff;
  }
  .case-type h2 {
    color: #4f46e5;
    font-size: 18px;
    margin-bottom: 6px;
  }
  .case-type p {
    color: #555;
    font-size: 14px;
    margin: 0;
  }

  /* --- Advocate Section --- */
  .advocate-list {
    display: none;
    margin-top: 30px;
    text-align: center;
  }
  .advocate-list h2 {
    color: #4f46e5;
    margin-bottom: 25px;
    font-size: 24px;
  }
  #advocatesContainer {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 20px;
  }
  .advocate-card {
    background: #fff;
    border-radius: 16px;
    padding: 20px;
    width: 250px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.12);
    transition: transform 0.3s, box-shadow 0.3s;
    text-align: center;
  }
  .advocate-card:hover {
    transform: translateY(-5px) scale(1.03);
    box-shadow: 0 12px 25px rgba(0,0,0,0.18);
  }
  .advocate-card h3 {
    color: #4f46e5;
    margin-bottom: 8px;
    font-size: 18px;
  }
  .advocate-card p {
    color: #333;
    font-size: 14px;
    margin: 5px 0;
  }
  .back-btn {
    background: linear-gradient(90deg,#4f46e5,#75f2f2);
    color: #fff;
    padding: 10px 18px;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    margin-top: 30px;
    font-weight: 600;
    transition: 0.3s;
  }
  .back-btn:hover {
    background: linear-gradient(90deg,#3730a3,#4f46e5);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  }
.hire-btn {
  margin-top: 12px;
  width: 100%;
  padding: 10px 0;
  background: linear-gradient(90deg,#4f46e5,#75f2f2);
  color: white;
  border: none;
  font-size: 15px;
  border-radius: 10px;
  cursor: pointer;
  font-weight: 600;
  transition: 0.3s;
}

.hire-btn:hover {
  background: linear-gradient(90deg,#3730a3,#4f46e5);
  transform: translateY(-3px);
  box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}


  /* --- Responsive --- */
  @media(max-width:768px){
    .case-type, .advocate-card { width: 80%; }
    .search-box input { width: 150px; }
  }
</style>
</head>
<body>

  <h1>Types of Legal Cases</h1>
  <p class="intro">Select your case type to find specialized advocates or search by your area.</p>

  <div class="search-box">
    <input type="number" id="pincodeInput" placeholder="Enter your pincode" />
    <button onclick="searchByPincode()">Search</button>
  </div>

  <div id="caseList">
    <div class="case-type" onclick="showAdvocates('All')"><h2>All Types</h2></div>
    <div class="case-type" onclick="showAdvocates('Civil')"><h2>Civil Cases</h2></div>
    <div class="case-type" onclick="showAdvocates('Criminal')"><h2>Criminal Cases</h2></div>
    <div class="case-type" onclick="showAdvocates('Constitutional')"><h2>Constitutional Cases</h2></div>
    <div class="case-type" onclick="showAdvocates('Administrative')"><h2>Administrative Cases</h2></div>
    <div class="case-type" onclick="showAdvocates('Family')"><h2>Family Cases</h2></div>
    <div class="case-type" onclick="showAdvocates('Commercial')"><h2>Commercial Cases</h2></div>
    <div class="case-type" onclick="showAdvocates('Labour')"><h2>Labour / Industrial Cases</h2></div>
    <div class="case-type" onclick="showAdvocates('Taxation')"><h2>Taxation Cases</h2></div>
    <div class="case-type" onclick="showAdvocates('PIL')"><h2>Public Interest Litigation (PIL)</h2></div>
  </div>

  <div id="advocateSection" class="advocate-list">
    <h2 id="advocateTitle"></h2>
    <div id="advocatesContainer"></div>
    <button class="back-btn" onclick="goBack()">â¬… Back</button>
  </div>

 <script>
// BASE URL
const BASE_URL = "https://nyaysetu-backend-1-laql.onrender.com";

// Fetch all advocates from backend
async function fetchAdvocates() {
    try {
        const res = await fetch(`${BASE_URL}/authAdvocate/all`);
        const data = await res.json();
        if (!data.success) return [];
        return data.advocates;
    } catch (err) {
        console.error("Failed to fetch advocates:", err);
        return [];
    }
}

// Filter advocates by specialization and/or pincode
function filterAdvocates(advocates, filter = {}) {
    return advocates.filter(adv => {
        let matchesSpecialization = true;
        let matchesPincode = true;

        // Check specialization
        if (filter.specialization && filter.specialization !== "All") {
            if (Array.isArray(adv.specialization)) {
                matchesSpecialization = adv.specialization.includes(filter.specialization);
            } else if (typeof adv.specialization === "string") {
                matchesSpecialization = adv.specialization === filter.specialization;
            } else {
                matchesSpecialization = false;
            }
        }

        // Check pincode
        if (filter.pincode) {
            matchesPincode = adv.pincode && adv.pincode.toString() === filter.pincode.toString();
        }

        return matchesSpecialization && matchesPincode;
    });
}

// Show advocates on page
async function showAdvocates(type) {
    document.getElementById("caseList").style.display = "none";
    document.getElementById("advocateSection").style.display = "block";

    document.getElementById("advocateTitle").innerText =
        type === "All" ? "All Case Advocates" : `${type} Case Advocates`;

    const allAdvocates = await fetchAdvocates();
    const filtered = filterAdvocates(allAdvocates, { specialization: type });
    displayAdvocates(filtered);
}

// Search by pincode
async function searchByPincode() {
    const input = document.getElementById("pincodeInput").value.trim();
    if (!input) { alert("Enter valid pincode"); return; }

    document.getElementById("caseList").style.display = "none";
    document.getElementById("advocateSection").style.display = "block";

    document.getElementById("advocateTitle").innerText = `Advocates near Pincode ${input}`;
    const allAdvocates = await fetchAdvocates();
    const filtered = filterAdvocates(allAdvocates, { pincode: input });
    displayAdvocates(filtered);
}

function displayAdvocates(list) {
    const container = document.getElementById("advocatesContainer");
    container.innerHTML = "";

    console.log(list); // <-- ADD THIS

    if (!list.length) {
        container.innerHTML = "<p>No advocates found.</p>";
        return;
    }

    list.forEach(adv => {
        console.log(adv.mobile); // <-- check each mobile
        const specialization = Array.isArray(adv.specialization) && adv.specialization.length > 0
            ? adv.specialization.join(", ")
            : "Not given";

        const phone = adv.mobile && adv.mobile.trim() !== "" ? adv.mobile : "Not given";
        const email = adv.email && adv.email.trim() !== "" ? adv.email : "Not given";
        const experience = adv.experience && adv.experience.trim() !== "" ? adv.experience : "Not given";
        const pincode = adv.pincode && adv.pincode.trim() !== "" ? adv.pincode : "Not given";
        const name = adv.name && adv.name.trim() !== "" ? adv.name : "Name not given";

        const card = document.createElement("div");
        card.className = "advocate-card";
        card.innerHTML = `
            <h3>${name}</h3>
            <p><strong>Experience:</strong> ${experience}</p>
            <p><strong>Specialization:</strong> ${specialization}</p>
            <p><strong>Phone:</strong> ${phone}</p>
            <p><strong>Email:</strong> ${email}</p>
            <p><strong>Pincode:</strong> ${pincode}</p>
           <button class="hire-btn">Hire Advocate</button>

        `;

        container.appendChild(card);

        const hireBtn = card.querySelector(".hire-btn");
hireBtn.addEventListener("click", () => hireAdvocate(adv._id));
    });
}

// Hire advocate
async function hireAdvocate(id) {
    const token = localStorage.getItem("userToken");
     console.log("Token used for hiring:", token); // debug
    if (!token) {
        alert("You must be logged in to hire an advocate!");
        return;
    }

    const body = {
        advocateId: id,
        caseType: "General",
        description: "User wants consultation"
    };

    try {
        const res = await fetch("https://nyaysetu-backend-1-laql.onrender.com/api/hire", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": "Bearer " + token
            },
            body: JSON.stringify(body)
        });

        if (res.status === 401) {
            alert("Unauthorized! Please log in first.");
            return;
        }

        const data = await res.json();
        alert(data.message);
    } catch (err) {
        console.error(err);
        alert("Something went wrong while hiring the advocate.");
    }
}

// Back button
function goBack() {
    document.getElementById("caseList").style.display = "flex";
    document.getElementById("advocateSection").style.display = "none";
}
</script>
</body>
</html>